import { Callout } from 'nextra/components'

# 3.Config

The toolchain now exposes a single configuration surface through `@tailwindcss-mangle/config`. Two top-level sections keep responsibilities clear:

- `registry` drives class discovery and Tailwind patching.
- `transformer` controls how the collected classes are rewritten in application code.

Legacy files that still export `patch` / `mangle` continue to load, but new projects should adopt the updated shape for clarity and better tooling.

## Generate a starter file

```sh npm2yarn
npx tw-patch init
```

This command creates a minimal config at the project root:

```ts
import { defineConfig } from 'tailwindcss-patch'

export default defineConfig({})
```

<Callout type="info">
`defineConfig` provides typed completion. Unknown keys are preserved so you can pass additional options directly to `TailwindcssPatcher` or the bundler plugin.
</Callout>

## Example configuration

```ts
import { defineConfig } from 'tailwindcss-patch'

export default defineConfig({
  registry: {
    output: {
      file: '.tw-patch/tw-class-list.json',
      format: 'json',
      pretty: 2,
      stripUniversalSelector: true,
    },
    tailwind: {
      version: 4,
      next: {
        cssEntries: ['dist/tailwind.css'],
        sources: [
          { base: 'src', pattern: '**/*.{astro,tsx,mdx}', negated: false },
        ],
      },
    },
    features: {
      exportContext: true,
      extendLengthUnits: {
        units: ['rpx'],
      },
    },
    cache: {
      enabled: true,
      dir: '.tw-patch/cache',
      strategy: 'merge',
    },
  },
  transformer: {
    sources: {
      include: [/\.(html|vue|tsx|jsx|mdx)$/],
    },
    generator: {
      classPrefix: 'tw-',
      reserveClassName: [/^theme-/],
    },
    registry: {
      file: '.tw-patch/tw-class-list.json',
      mapping: {
        enabled: false,
        file: '.tw-patch/tw-map-list.json',
        loose: true,
      },
    },
    preserve: {
      functions: ['twIgnore'],
    },
  },
})
```

## Registry options

### `output`

- `file` – destination for the extracted inventory (default `.tw-patch/tw-class-list.json`).
- `format` – either `json` or `lines`; the CLI uses JSON by default.
- `pretty` – `false`, a boolean, or a number of spaces when writing JSON.
- `stripUniversalSelector` – skip `*` from the generated list when `true`.

### `tailwind`

- `version` – optional hint (`2`, `3`, or `4`) when multiple versions are installed.
- `legacy` / `classic` – configure Tailwind v2/v3 instances living in workspace packages (`cwd`, `config`).
- `next.cssEntries` – CSS entry files used by the Oxide scanner. Repeat for multi-bundle setups.
- `next.sources` – custom content sources for v4 projects (defaults to `**/*` under `base`).

### `features`

- `exportContext` – expose Tailwind contexts at runtime so the API can read them back later.
- `extendLengthUnits` – customise the built-in length-unit patching; accepts `false`, `true`, or an option object (`units`, `overwrite`, etc.).

### `cache`

- `enabled` – persist collected classes under `node_modules/.cache/tailwindcss-patch` (enabled by default).
- `dir` / `file` – control where the cache set is stored.
- `strategy` – `merge` adds to the existing cache, `overwrite` replaces it on each extraction.

## Transformer options

The transformer block is consumed by both the core runtime and `unplugin-tailwindcss-mangle`.

- `sources.include` / `sources.exclude` – control which files the plugin scans; defaults cover HTML, frameworks, CSS, and MDX.
- `generator` – customise minified names via `classPrefix`, `reserveClassName`, `exclude`, or `customGenerate`.
- `registry.file` – path to the class list produced by the registry.
- `registry.mapping` – `true` reuses defaults, an object enables JSON output (`enabled`, `file`, `loose`), or supply a callback for full control.
- `filter` – override the class-level filter before the generator runs.
- `preserve.functions` – helper names (e.g. `twIgnore`) that mark template literals as safe from mangling.
- `disabled` – when `true`, skips rewriting (defaults to `process.env.NODE_ENV === 'development'`).

<Callout type="info">
Existing configs that expose `patch` / `mangle` still load. The loader converts them to the new shape internally so you can migrate incrementally.
</Callout>

## Using the config

- `tw-patch install` / `tw-patch extract` resolve this file automatically.
- `unplugin-tailwindcss-mangle` mirrors the same configuration, so plugin options and CLI behaviour stay aligned.
- When you need programmatic control, construct a `TailwindcssPatcher` manually and pass the registry portion—the legacy keys are converted for you at runtime.
