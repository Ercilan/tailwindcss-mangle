import { Callout } from 'nextra/components'

# 2.Mangle

## What it does

```html
<!-- Before modification -->
<div class="z-10 w-full max-w-5xl items-center justify-between font-mono text-sm lg:flex"></div>
<!-- After modification -->
<div class="tw-g tw-h tw-i tw-d tw-e tw-j tw-k tw-l"></div>
```

`unplugin-tailwindcss-mangle` reads the class inventory generated by `tailwindcss-patch` and rewrites matching class names across your templates, JSX, MDX, and inline strings. The result is a production build with compact, less guessable class names.

## Quick start

1. Install the packages.

   ```sh npm2yarn
   npm i -D tailwindcss-patch unplugin-tailwindcss-mangle
   ```

2. Patch Tailwind and extract the class list.

   ```sh
   npx tw-patch install
   npx tw-patch extract
   ```

3. Keep `tw-patch install` in your `prepare` script so installs stay patched.

   ```json
   {
     "scripts": {
       "prepare": "tw-patch install"
     }
   }
   ```

4. Register the plugin for your bundler and point `classListPath` at `.tw-patch/tw-class-list.json`.

<Callout type="info">
The config loader merges `tailwindcss-patch` and `unplugin-tailwindcss-mangle` settings. Adjust paths or filters once in <a href="../config">Config</a>, then reuse them everywhere.
</Callout>

## Supported bundlers

### Vite

```ts
// vite.config.ts
import vue from '@vitejs/plugin-vue'
import tailwindcssMangle from 'unplugin-tailwindcss-mangle/vite'
import { defineConfig } from 'vite'

export default defineConfig({
  plugins: [
    vue(),
    tailwindcssMangle({
      classListPath: '.tw-patch/tw-class-list.json',
    }),
  ],
})
```

### Webpack

```js
// webpack.config.js
const { webpackPlugin: tailwindcssMangle } = require('unplugin-tailwindcss-mangle')

module.exports = {
  // ...
  plugins: [
    tailwindcssMangle({
      classListPath: '.tw-patch/tw-class-list.json',
    }),
  ],
}
```

### Rollup

```ts
// rollup.config.ts
import tailwindcssMangle from 'unplugin-tailwindcss-mangle/rollup'

export default {
  plugins: [
    tailwindcssMangle({
      classListPath: '.tw-patch/tw-class-list.json',
    }),
  ],
}
```

### Nuxt 3

```ts
// nuxt.config.ts
import tailwindcssMangle from 'unplugin-tailwindcss-mangle/nuxt'

export default defineNuxtConfig({
  experimental: {
    inlineSSRStyles: false,
  },
  modules: [
    [
      tailwindcssMangle,
      {
        classListPath: '.tw-patch/tw-class-list.json',
      },
    ],
  ],
})
```

### Esbuild

```ts
// build.mjs
import { build } from 'esbuild'
import tailwindcssMangle from 'unplugin-tailwindcss-mangle/esbuild'

await build({
  entryPoints: ['src/main.ts'],
  bundle: true,
  outfile: 'dist/index.js',
  plugins: [
    tailwindcssMangle({
      classListPath: '.tw-patch/tw-class-list.json',
    }),
  ],
})
```

## Plugin options

Configure the plugin inline or through the shared config file.

- `classListPath` – points to the class inventory produced by `tw-patch extract`.
- `include` / `exclude` – refine which files are scanned. The defaults cover HTML, major frameworks, CSS, and MDX.
- `mangleClassFilter` – skip classes based on custom logic before they are rewritten.
- `classGenerator` – tweak the generator (prefix, reserved classes, or provide a `customGenerate` callback).
- `classMapOutput` – set to `true` or provide `{ enable, filename, loose }` to write a JSON map of before/after pairs.
- `preserveFunction` – mark helper functions (such as `twIgnore`) that should keep template literals untouched.
- `disabled` – skip mangling entirely (auto-disabled in development by default).

## Ignoring and preserving

Use `preserveFunction` to wrap strings you want to keep verbatim. The default config ships with `twIgnore`, which works with template literals:

```js
const twIgnore = String.raw
const className = `${twIgnore`gap-y-4`} bg-zinc-800/30`
```

After mangling:

```js
const twIgnore = String.raw
const className = `${twIgnore`gap-y-4`} tw-a`
```

Enable `classMapOutput` to generate a `.tw-patch/tw-map-list.json` file and inspect which files use each minified class.

## Notes

- The plugin only rewrites utility classes containing `-` or `:`, such as `w-32`, `before:h-[300px]`, or `after:dark:via-[#0141ff]/40`. Plain tokens like `flex` are left untouched to avoid false positives.
- By default, mangling runs during production builds. Set `disabled: false` to experiment in development.
- The scanner traverses HTML `class` attributes and common string literals. Avoid mutating arbitrary strings at runtime before they reach the plugin.
